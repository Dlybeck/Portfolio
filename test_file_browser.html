<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgentBridge File Browser Debug</title>
    <style>
        body {
            font-family: monospace;
            background: #1e1e1e;
            color: #ddd;
            padding: 20px;
        }
        .test-section {
            background: #2a2a2a;
            border: 1px solid #444;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
        }
        h2 {
            color: #4a9eff;
            margin-top: 0;
        }
        button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #0052a3;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
        .status.ok {
            background: #238636;
        }
        .status.error {
            background: #f85149;
        }
        pre {
            background: #0d1117;
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üîç AgentBridge File Browser Debug Tool</h1>

    <div class="test-section">
        <h2>1. Check Authentication</h2>
        <button onclick="checkAuth()">Check Token</button>
        <span id="auth-status"></span>
        <pre id="auth-result"></pre>
    </div>

    <div class="test-section">
        <h2>2. Test /api/agentbridge/cwd</h2>
        <button onclick="testCwd()">Test CWD Endpoint</button>
        <span id="cwd-status"></span>
        <pre id="cwd-result"></pre>
    </div>

    <div class="test-section">
        <h2>3. Test /api/agentbridge/browse</h2>
        <button onclick="testBrowse()">Test Browse (Home)</button>
        <button onclick="testBrowse('/home/dlybeck')">Test Browse (/home/dlybeck)</button>
        <span id="browse-status"></span>
        <pre id="browse-result"></pre>
    </div>

    <div class="test-section">
        <h2>4. Test /api/agentbridge/recent-projects</h2>
        <button onclick="testRecent()">Test Recent Projects</button>
        <span id="recent-status"></span>
        <pre id="recent-result"></pre>
    </div>

    <div class="test-section">
        <h2>5. Browser Console Logs</h2>
        <p>Open browser console (F12) to see detailed logs from AgentBridge</p>
        <button onclick="window.location.href='/dev/agentbridge'">Open AgentBridge Dashboard</button>
    </div>

    <script>
        function checkAuth() {
            const token = localStorage.getItem('access_token');
            const statusEl = document.getElementById('auth-status');
            const resultEl = document.getElementById('auth-result');

            if (token) {
                statusEl.innerHTML = '<span class="status ok">‚úì Token Found</span>';
                resultEl.textContent = 'Token: ' + token.substring(0, 20) + '...' + token.substring(token.length - 10);
            } else {
                statusEl.innerHTML = '<span class="status error">‚úó No Token</span>';
                resultEl.textContent = 'No access_token found in localStorage.\nYou need to login first at /dev/terminal';
            }
        }

        async function testCwd() {
            const statusEl = document.getElementById('cwd-status');
            const resultEl = document.getElementById('cwd-result');
            const token = localStorage.getItem('access_token');

            statusEl.innerHTML = 'Testing...';
            resultEl.textContent = 'Requesting /api/agentbridge/cwd...';

            try {
                const res = await fetch('/api/agentbridge/cwd', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await res.json();

                if (res.ok) {
                    statusEl.innerHTML = '<span class="status ok">‚úì Success</span>';
                    resultEl.textContent = JSON.stringify(data, null, 2);
                } else {
                    statusEl.innerHTML = '<span class="status error">‚úó Error ' + res.status + '</span>';
                    resultEl.textContent = JSON.stringify(data, null, 2);
                }
            } catch (e) {
                statusEl.innerHTML = '<span class="status error">‚úó Exception</span>';
                resultEl.textContent = e.message + '\n\n' + e.stack;
            }
        }

        async function testBrowse(path = null) {
            const statusEl = document.getElementById('browse-status');
            const resultEl = document.getElementById('browse-result');
            const token = localStorage.getItem('access_token');

            const url = path ? `/api/agentbridge/browse?path=${encodeURIComponent(path)}` : '/api/agentbridge/browse';

            statusEl.innerHTML = 'Testing...';
            resultEl.textContent = 'Requesting ' + url + '...';

            try {
                const res = await fetch(url, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await res.json();

                if (res.ok) {
                    statusEl.innerHTML = '<span class="status ok">‚úì Success</span>';
                    resultEl.textContent = 'Path: ' + data.path + '\n' +
                        'Entries: ' + data.entries.length + '\n' +
                        'Directories: ' + data.entries.filter(e => e.is_dir).length + '\n\n' +
                        JSON.stringify(data, null, 2);
                } else {
                    statusEl.innerHTML = '<span class="status error">‚úó Error ' + res.status + '</span>';
                    resultEl.textContent = JSON.stringify(data, null, 2);
                }
            } catch (e) {
                statusEl.innerHTML = '<span class="status error">‚úó Exception</span>';
                resultEl.textContent = e.message + '\n\n' + e.stack;
            }
        }

        async function testRecent() {
            const statusEl = document.getElementById('recent-status');
            const resultEl = document.getElementById('recent-result');
            const token = localStorage.getItem('access_token');

            statusEl.innerHTML = 'Testing...';
            resultEl.textContent = 'Requesting /api/agentbridge/recent-projects...';

            try {
                const res = await fetch('/api/agentbridge/recent-projects', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await res.json();

                if (res.ok) {
                    statusEl.innerHTML = '<span class="status ok">‚úì Success</span>';
                    resultEl.textContent = 'Projects: ' + data.projects.length + '\n\n' +
                        JSON.stringify(data, null, 2);
                } else {
                    statusEl.innerHTML = '<span class="status error">‚úó Error ' + res.status + '</span>';
                    resultEl.textContent = JSON.stringify(data, null, 2);
                }
            } catch (e) {
                statusEl.innerHTML = '<span class="status error">‚úó Exception</span>';
                resultEl.textContent = e.message + '\n\n' + e.stack;
            }
        }

        // Auto-check auth on load
        window.addEventListener('DOMContentLoaded', checkAuth);
    </script>
</body>
</html>
